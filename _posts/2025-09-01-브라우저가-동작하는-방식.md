---
title : 브라우저가 동작하는 방식
date : 2025-09-01 00:50:00 +9:00
categories : [Javascript]
tags : [Javascript, Browser]
---
## 브라우저의 구성 요소
- 사용자 인터페이스(UI) : 레이어는 브라우저에서 볼 수 있는 거의 모든 것으로, 요청한 페이지를 보여주는 창 외의 모든 UI를 의미 (주소창, 뒤로가기, 앞으로 가기, 새로고침, 북마크, 환경설정과 같은 UI)
- 브라우저 엔진 : 사용자 인터페이스와 렌더링 엔진 사이에서 중개자 역할. 만약 여러분들이 사용자 인터페이스 레이어에 있는 새로고침 버튼을 눌렀다면, 브라우저 엔진은 이를 이해하고 새로고침 명령을 수행한다. 
- 렌더링 엔진 : HTML과 CSS, JavaScript를 파싱하고 그 결과물을 바탕으로 페이지를 그려내는 역할. 
각 브라우저는 다양한 엔진을 사용하는데, Chrome과 Opera, Edge는 Blink를, Firefox는 Gecko를, Internet Explorer는 Trident를, Safari는 WebKit을 사용 
- 네트워크 레이어 : HTTP나 HTTPS 같은 프로토콜을 이용해 외부의 리소스를 얻어오고, 서버에 요청을 보낼 때 사용되는 레이어
- JavaScript 인터프리터 : JavaScript를 해석하고 실행하는 역할
- UI 백엔드 : 는 브라우저가 동작하고 있는 운영체제의 인터페이스를 따르는 UI들을 처리
- 자료 저장소 : 브라우저 자체에서 하드디스크와 같이 데이터를 로컬에 저장하기 위한 레이어로, 쿠키나 로컬 스토리지, 세션 스토리지, IndexedDB, 웹 SQL, 파일시스템 등에 접근하고 데이터를 저장하는 데 사용 됨.

## 렌더링 동작 과정
각 단계에서 리소스를 로드하는 순서나 작성한 스크립트의 내용에 따라 웹 페이지의 반응 속도가 달라질 수 있다.
파싱(Parsing) - 렌더 트리(Render Tree) 구축 - 레이아웃(Layout) 또는 리플로우(Reflow) - 페인트(Paint)
1. HTML 문서를 파싱 한다.
2. 콘텐츠 트리 내부에서 태그를 DOM 노드로 변환한다.
3. 외부 CSS 파일과 함께 포함된 스타일 요소도 파싱 한다.
4. 스타일 정보와 HTML 표시 규칙은 “렌더 트리”라는 또 다른 트리를 생성한다.
5. 렌더 트리는 정해진 순서대로 화면에 표시된다.
6. 렌더트리 생성이 끝나면 배치가 시작된다. 배치: 각 노드가 화면의 정확한 위치에 표시되는 것
7. 그리기 과정: UI 백엔드에서 렌더 트리의 각 노드를 가로지르며 형상을 만들어 낸다.

- 위의 과정들이 점진적으로 진행되며, 사용자 경험을 위해 HTML 파싱을 기다리지 않고 배치와 그리기 과정을 진행한다.
- 전송을 기다리는 동시에 받은 내용의 일부를 먼저 화면에 표시한다.

## 파싱
- 파싱은 문자열이 정해진 문법을 모두 따르는지 확인하는 과정이다. 각 문법은 어휘와 문법 규칙으로 구성되어 있다.
- 브라우저는 HTML, CSS, JavaScript 세 종류의 언어를 해석할 수 있다. 
- JavaScript는 렌더링 엔진이 아닌 JavaScript 해석기에서 언어를 해석한다. 따라서 렌더링 엔진은 HTML과 CSS를 파싱 한다.
- 파서는 어휘 분석과 구문 분석을 거쳐 파싱 트리를 구축한다.

## HTML 파싱
- HTML의 문자열들을 이용해 파스 트리(Parse Tree 또는 문법 트리(syntax tree))를 생성한다.
- 파스 트리는 브라우저가 읽어야 할 HTML 코드를 트리 모양으로 구조화하여 나타낸 것
- 브라우저는 파스 트리를 이용해 DOM(Document Object Model) 트리를 새로 만든다.

## CSS 파싱
- CSS 파싱은 공식 명세에 따라 진행한다.
- HTML 코드 내에 CSS 링크가 있기 때문에, HTML을 파싱 하는 도중에 파싱이 시작된다.
- CSS 파서는 전체 파일을 모두 다운로드할 때까지 파싱을 시작할 수 없다.
- CSS 파싱 과정이 끝나면, 코드에서 명세한 내용과 순서를 바탕으로 DOM과 같은 트리를 구성한다.
- 이를 CSSOM(CSS Object Model) 트리라 부른다.

## 렌더 트리(Render Tree)
- DOM 트리가 구성되는 동안 브라우저는 렌더 트리( 또는 프레임 트리(Frame Tree))를 구성한다.
- 렌더 트리는 화면에 나타나는 요소들을 결정하는 트리이다.
- 어떤 요소가 보여야 할지, 어떤 스타일이 적용되어야 하는지, 어떤 순서로 나타낼 것인지를 명세한다.
- DOM 트리와 CSSOM 트리를 조합하여 만들어지고, 화면에 그려지지 않는 요소들은 트리에 나타나지 않는다. 
- 즉, 렌더 트리는 DOM 트리와 1:1로 매칭되지는 않는다.

## 레이아웃 또는 리플로우
- 렌더 트리에서 계산되지 않았던 노드들의 크기와 위치, 레이어 간 순서와 같은 정보를 계산하여 좌표에 나타낸다.
- 레이아웃은 계산의 범위에 따라 전역적 레이아웃(Global Layout)과 증분적 레이아웃(Incremental Layout)으로 구분할 수 있다.

## 페인트
- 레이아웃 단계를 통해 화면에 배치된 엘리먼트들에 색을 입히고 레이어의 위치를 결정한다.
- 페인팅도 전역적 페인팅과 증분적 페인팅으로 구분할 수 있다. 
- 페인팅은 "z-index"가 낮은 순서대로 먼저 페인팅된다.

## 가상 DOM
- 일반적으로 중요 렌더링 경로는 초당 60회 정도의 주기로 계산을 수행
- 가장 비용이 많이 드는 단계는 레이아웃과 페인트 단계이다.
- 가상 DOM은 실제로 렌더링 되지는 않았지만, 실제 DOM 구조를 반영한 상태로 메모리에 있는 가상의 DOM이다.
- 실제 화면에 그릴 필요는 없기 때문에 실제 DOM보다 연산 비용이 적고 가상 DOM은 변경 사항들을 한 번에 묶어서 실제 DOM에 반영한다.
- 때문에 레이아웃과 페인트 단계에서 한 번에 변경되어야 하는 사항은 많아지지만, 단 한 번의 계산만으로 DOM을 바꿀 수 있기 때문에 연산의 횟수는 최소한이 된다.
- React와 Vue은 가상 DOM을 사용하는 대표적인 라이브러리, 프레임워크이다.